ä»¥ä¸‹æ˜¯åŸºäºæœ€å°åŒ–éœ€æ±‚çš„ç²¾ç®€ç‰ˆéœ€æ±‚æ–‡æ¡£ï¼Œé‡‡ç”¨å¾®ä¿¡å°ç¨‹åºåŸç”Ÿæ¡†æ¶å®ç°ï¼š

---

# æç®€ç²¾åŠ›ç®¡ç†å°ç¨‹åºéœ€æ±‚æ–‡æ¡£ï¼ˆMVP 1.0ï¼‰

## ä¸€ã€æ ¸å¿ƒåŠŸèƒ½æ¸…å•
| æ¨¡å— | åŠŸèƒ½ç‚¹ | æŠ€æœ¯æ–¹æ¡ˆ | ä¼˜å…ˆçº§ |
|------|--------|----------|--------|
| å‹åŠ›æµ‹è¯• | emojiæé€Ÿè¯„ä¼° | é™æ€è§„åˆ™åŒ¹é… | P0 |
| å‘¼å¸è®­ç»ƒ | æ ‡å‡†åŒ–éŸ³é¢‘+å€’è®¡æ—¶ | wx.createInnerAudioContext + JSè®¡æ—¶å™¨ | P0 |
| ä¹ æƒ¯è¿½è¸ª | è‡ªåŠ¨æ‰“å¡+ç«ç„°è¿›åº¦ | wx.setStorageSync/wx.getStorageSync | P0 |
| æˆå°±ç³»ç»Ÿ | ç§°å·è§£é”+éŸ³æ•ˆå¥–åŠ± | wx.setStorageSync/wx.getStorageSync | P1 |

---

## äºŒã€è¯¦ç»†éœ€æ±‚è¯´æ˜

### 1. æé€Ÿå‹åŠ›æµ‹è¯•é¡µ
**é¡µé¢è·¯å¾„**ï¼špages/index/index  
**äº¤äº’æµç¨‹**ï¼š  
1. é¦–å±æ˜¾ç¤ºå¤§å­—æ ‡é¢˜ï¼š"ä½ ç°åœ¨çš„çŠ¶æ€æ˜¯ï¼Ÿ"  
2. ä¸‹æ–¹å¹¶æ’æ˜¾ç¤ºå¤šä¸ªemojiæŒ‰é’®ï¼ˆç¤ºä¾‹ï¼šğŸ”¥ğŸ˜‘âš¡ï¼‰ï¼Œå…·ä½“æ•°é‡å’Œæ ·å¼å·²åœ¨å¼€å‘ä¸­æ¼”è¿›ã€‚  
3. ç”¨æˆ·ç‚¹å‡»ä»»ä¸€emojiåï¼š  
   - æ ¹æ®é¢„è®¾è§„åˆ™è·³è½¬ç»“æœé¡µï¼ˆæ— éœ€ç½‘ç»œè¯·æ±‚ï¼‰  
   - æ˜ å°„è§„åˆ™ï¼š  
     ```javascript
     const strategy = {
       'ğŸ”¥': '/pages/training/training?type=fire',
       'ğŸ˜‘': '/pages/training/training?type=tired',
       'âš¡': '/pages/training/training?type=energy'
       // ...æ›´å¤šè¡¨æƒ…å’Œç±»å‹
     }
     ```

### 2. å‘¼å¸è®­ç»ƒé¡µ
**é¡µé¢è·¯å¾„**ï¼špages/training/training  
**æŠ€æœ¯å®ç°**ï¼š  
- ä½¿ç”¨ `wx.createInnerAudioContext` æ’­æ”¾æœ¬åœ°éŸ³é¢‘æ–‡ä»¶  
- å€’è®¡æ—¶ï¼šé€šè¿‡ Page çš„ data å’Œ JavaScript setInterval/setTimeout å®ç°ï¼Œæ›´æ–°ç•Œé¢æ˜¾ç¤ºã€‚  
**äº¤äº’æµç¨‹**ï¼š  
1. è¿›å…¥é¡µé¢ï¼Œç”¨æˆ·æ‰‹åŠ¨è§¦å‘å¼€å§‹æ’­æ”¾å‘¼å¸éŸ³é¢‘ï¼ˆä¾‹å¦‚ï¼š4ç§’å¸æ°”-7ç§’å±æ¯-8ç§’å‘¼æ°”å¾ªç¯ï¼‰  
2. å±å¹•ä¸­å¤®æ˜¾ç¤ºåŠ¨æ€å‘¼å¸æŒ‡ç¤ºå™¨ï¼ˆCanvasåœ†å½¢ç¼©æ”¾åŠ¨ç”»ï¼‰åŠå€’è®¡æ—¶  
3. å€’è®¡æ—¶ç»“æŸåï¼š  
   - å¼¹å‡ºå¿ƒæƒ…è¡¨æƒ…æŒ‰é’®ï¼ˆç¤ºä¾‹ï¼šğŸ˜ğŸ˜ŠğŸ˜­ï¼‰  
   - è®°å½•é€‰æ‹©ç»“æœåˆ°æœ¬åœ°å­˜å‚¨ï¼š  
     ```javascript
     wx.setStorageSync('last_mood', mood)
     ```

### 3. ä¹ æƒ¯è¿›åº¦é¡µ (å·²è°ƒæ•´ä¸ºé¦–é¡µ"æœ€è¿‘ç»ƒä¹ è®°å½•"å’Œ"å†å²å›¾è¡¨")
**æ•´åˆä½ç½®**ï¼špages/index/index éƒ¨åˆ†åŠŸèƒ½  
**æ•°æ®å­˜å‚¨**ï¼š `wx.getStorageSync`, `wx.setStorageSync`  
```javascript
// å­˜å‚¨ç»“æ„ç¤ºä¾‹ (trainingHistory)
[
  { date: '2024-03-15T10:30:00.000Z', duration: 180, mood: 'ğŸ˜Š' },
  // ...æ›´å¤šè®°å½•
]
```  
**ç•Œé¢å…ƒç´ ** (å·²åœ¨é¦–é¡µå®ç°)ï¼š  
1. é¦–é¡µæ˜¾ç¤ºæœ€è¿‘ç»ƒä¹ è®°å½•åˆ—è¡¨ã€‚  
2. é¦–é¡µæ˜¾ç¤ºç»ƒä¹ å†å²çš„æŸ±çŠ¶å›¾è¡¨ã€‚

**è‡ªåŠ¨æ‰“å¡é€»è¾‘** (åœ¨è®­ç»ƒå®Œæˆæ—¶å¤„ç†)ï¼š  
```javascript
// è®­ç»ƒå®Œæˆæ—¶ (pages/training/training.js)
function recordTrainingSession(duration, mood) {
  const now = new Date().toISOString();
  const newRecord = { date: now, duration: duration, mood: mood };
  
  let history = wx.getStorageSync('trainingHistory') || [];
  history.unshift(newRecord); // Add to the beginning
  // Optional: Limit history size, e.g., history = history.slice(0, 50);
  wx.setStorageSync('trainingHistory', history);
  
  // è¿ç»­æ‰“å¡é€»è¾‘ (streak_days) å¯ä»¥åŸºäº trainingHistory è®¡ç®—æˆ–å•ç‹¬å­˜å‚¨
  // ä¾‹å¦‚ï¼Œæ£€æŸ¥ today's date vs last_date in another storage item
}
```

### 4. æˆå°±ç³»ç»Ÿ (éƒ¨åˆ†å®ç°ï¼Œå¯æ‰©å±•)
**è§¦å‘æ¡ä»¶**ï¼š  
- è®­ç»ƒå®Œæˆæ—¶ï¼Œæ ¹æ®ç»ƒä¹ æ•°æ®ï¼ˆå¦‚è¿ç»­å¤©æ•°ã€æ€»æ—¶é•¿ç­‰ï¼‰åˆ¤æ–­æ˜¯å¦è§£é”æˆå°±ã€‚  
- ä¾‹å¦‚ï¼šè¿ç»­3å¤©å®Œæˆè®­ç»ƒï¼Œå¯è§£é”æ–°çš„èƒŒæ™¯éŸ³ä¹æˆ–æç¤ºã€‚  

**å¥–åŠ±å‘æ”¾**ï¼š  
```javascript
// éŸ³é¢‘æ–‡ä»¶åŠ¨æ€åŠ è½½ (pages/training/training.js)
const audioMap = {
  default: '/static/audio/zen.mp3', // é»˜è®¤éŸ³é¢‘
  reward_rain: '/static/audio/rain.mp3', // å¥–åŠ±éŸ³é¢‘ - é›¨å£°
  completion_sound: '/static/audio/end.mp3' // è®­ç»ƒå®Œæˆæç¤ºéŸ³
};
// String currentTrack = audioMap.default;
// if (isRewardUnlocked) { currentTrack = audioMap.reward_rain; }
// audioContext.src = currentTrack;
```

---

## ä¸‰ã€æŠ€æœ¯å®æ–½æ–¹æ¡ˆ

### 1. å‰ç«¯æ¶æ„ (å¾®ä¿¡å°ç¨‹åºåŸç”Ÿ)
```bash
zenflowapp/
â”œâ”€â”€ pages/                # é¡µé¢ç›®å½•
â”‚   â”œâ”€â”€ index/            # é¦–é¡µ (å«å‹åŠ›è¯„ä¼°ã€å†å²è®°å½•ã€å›¾è¡¨)
â”‚   â”œâ”€â”€ progress/         # (åŸè§„åˆ’ï¼ŒåŠŸèƒ½å·²å¹¶å…¥indexæˆ–å¾…å®š)
â”‚   â””â”€â”€ training/         # å‘¼å¸è®­ç»ƒé¡µ
â”œâ”€â”€ static/               # é™æ€èµ„æº
â”‚   â”œâ”€â”€ audio/            # MP3éŸ³é¢‘æ–‡ä»¶
â”‚   â”œâ”€â”€ emoji/            # Emojiå›¾ç‰‡ (å¦‚æœä¸æ˜¯ç›´æ¥ç”¨æ–‡æœ¬å­—ç¬¦)
â”‚   â””â”€â”€ images/           # å…¶ä»–å›¾ç‰‡èµ„æº (å¦‚äºŒç»´ç )
â”œâ”€â”€ app.js                # å°ç¨‹åºé€»è¾‘
â”œâ”€â”€ app.json              # å°ç¨‹åºå…¬å…±é…ç½®
â”œâ”€â”€ app.wxss              # å°ç¨‹åºå…¬å…±æ ·å¼è¡¨
â”œâ”€â”€ project.config.json   # é¡¹ç›®é…ç½®æ–‡ä»¶
â””â”€â”€ sitemap.json          # ç«™ç‚¹åœ°å›¾é…ç½®
```

### 2. å…³é”®ä»£ç ç‰‡æ®µ (å¾®ä¿¡å°ç¨‹åºåŸç”Ÿ)
**è‡ªåŠ¨æ‰“å¡æ£€æµ‹/è¿ç»­è®°å½•**ï¼š  
åœ¨ `pages/training/training.js` ä¸­è®­ç»ƒç»“æŸæ—¶ï¼Œè¯»å– `trainingHistory`ï¼Œåˆ†ææ—¥æœŸæ¥è®¡ç®—è¿ç»­å¤©æ•°ã€‚  
```javascript
// In pages/training/training.js, after a session:
function checkAndUpdateStreak() {
  const history = wx.getStorageSync('trainingHistory') || [];
  if (history.length === 0) return { streak: 0, lastDate: null };

  let streak = 0;
  let lastPracticeDate = null;
  const today = new Date();
  today.setHours(0,0,0,0); // Normalize today to start of day

  // Iterate through history to calculate streak
  for (let i = 0; i < history.length; i++) {
    const recordDate = new Date(history[i].date);
    recordDate.setHours(0,0,0,0); // Normalize record date

    if (i === 0) { // Most recent record
      if (recordDate.getTime() === today.getTime()) {
        streak = 1;
        lastPracticeDate = recordDate;
      } else {
        // Not today, check if yesterday for streak continuation
        const yesterday = new Date(today);
        yesterday.setDate(today.getDate() - 1);
        if (recordDate.getTime() === yesterday.getTime()) {
          streak = 1; // This logic needs to count backwards properly
          // This simplified version just checks the first entry.
          // For a full streak, you'd compare against previous entries.
          // For now, this is placeholder for more robust logic based on history
        } else {
          break; // Streak broken if most recent wasn't today or yesterday
        }
      }
    } else {
        // Logic to check if recordDate is consecutive to lastPracticeDate
        const expectedPreviousDay = new Date(lastPracticeDate);
        expectedPreviousDay.setDate(lastPracticeDate.getDate() - 1);
        if (recordDate.getTime() === expectedPreviousDay.getTime()) {
            streak++;
            lastPracticeDate = recordDate;
        } else {
            break; // Streak broken
        }
    }
  }
  // wx.setStorageSync('currentStreak', streak);
  // console.log('Current streak:', streak);
}
// æ­¤å¤„æ‰“å¡é€»è¾‘ä»…ä¸ºç¤ºä¾‹ï¼Œå®é™…é¡¹ç›®ä¸­å·²æ¼”åŒ–ä¸ºåŸºäº trainingHistory çš„æ›´å¤æ‚è®¡ç®—ã€‚
// å…¨å±€çŠ¶æ€æˆ–é¡µé¢é—´é€šä¿¡ï¼Œå¯ä»¥ä½¿ç”¨ getApp() è·å–å…¨å±€å®ä¾‹æˆ– getCurrentPages()ã€‚
// ä¾‹å¦‚: getApp().globalData.lastDate = ...
// æˆ–: const prevPage = getCurrentPages().slice(-2)[0]; prevPage.setData(...);
```

**éŸ³é¢‘å¤„ç†**ï¼š  
```javascript
// In pages/training/training.js
const audioContext = wx.createInnerAudioContext();
audioContext.src = '/static/audio/zen.mp3'; // Or from audioMap
audioContext.onPlay(() => {
  console.log('Playback started');
  // iOS è¿”å›ä¼šè‡ªåŠ¨æ’­æ”¾ï¼ŒonShowé‡Œå¤„ç†äº†æš‚åœå’Œæ’­æ”¾
  // const systemInfo = wx.getSystemInfoSync();
  // if (systemInfo.platform === 'ios') {
    // audioContext.seek(0); // May not be needed with onHide/onShow logic
  // }
});
audioContext.onError((res) => {
  console.error('Audio Error:', res.errMsg, res.errCode);
});
// audioContext.play();
// audioContext.pause();
// audioContext.stop();
// audioContext.destroy();
```

---

## å››ã€æµ‹è¯•è¦ç‚¹
| æµ‹è¯•ç±»å‹ | ç”¨ä¾‹ | é¢„æœŸç»“æœ |
|---------|------|----------|
| å…¼å®¹æ€§ | iOS/Androidæ’­æ”¾éŸ³é¢‘ | æ— å»¶è¿Ÿ/ä¸­æ–­, èƒŒæ™¯åˆ‡æ¢åèƒ½æ­£ç¡®æ¢å¤ |
| æ•°æ®æŒä¹… | æ€æ­»è¿›ç¨‹åé‡æ–°æ‰“å¼€ | ä¿æŒç»ƒä¹ å†å²å’Œç»Ÿè®¡ |
| è¾¹ç•Œå€¼ | è·¨æ—¥æœŸè®­ç»ƒï¼ˆå¦‚23:59å¼€å§‹ï¼‰ | æ­£ç¡®è®°å½•æ—¥æœŸå’Œè®¡ç®—ç»Ÿè®¡ |

---

## äº”ã€ä¸Šçº¿è®¡åˆ’
**Day 1 (å›é¡¾å·²å®Œæˆéƒ¨åˆ†)**ï¼š  
- åŸºç¡€é¡µé¢æ¡†æ¶ (index, training)
- éŸ³é¢‘æ’­æ”¾ã€CanvasåŠ¨ç”»ã€å€’è®¡æ—¶é€»è¾‘
- emojié€‰æ‹©ä¸è·³è½¬
- ç»ƒä¹ å†å²è®°å½•ä¸å›¾è¡¨å±•ç¤º
- æ”¯æŒä¸å»ºè®®æ¨¡å—
- Dockæ  Emoji äº¤äº’

**åç»­/ä¼˜åŒ– (å¯ä½œä¸ºè¿­ä»£)**ï¼š  
- å®Œå–„æˆå°±ç³»ç»Ÿï¼ˆæ›´ä¸°å¯Œçš„ç§°å·å’Œå¥–åŠ±ï¼‰
- ä¹ æƒ¯è¿›åº¦é¡µ (å¦‚æœå†³å®šå•ç‹¬åˆ›å»º pages/progress/progress)
- ç»†åŒ–æ‰“å¡å’Œè¿ç»­å¤©æ•°é€»è¾‘ï¼Œæä¾›æ›´æ˜ç¡®çš„åé¦ˆ
- UI/UX æŒç»­æ‰“ç£¨å’Œæ€§èƒ½ä¼˜åŒ–
- æäº¤å¾®ä¿¡å°ç¨‹åºå®¡æ ¸

**Day X**ï¼š  
- æ ¹æ®å®¡æ ¸åé¦ˆå¾®è°ƒ
- æ­£å¼å‘å¸ƒ

---

è¯¥æ–¹æ¡ˆåŸºäºå¾®ä¿¡å°ç¨‹åºåŸç”Ÿæ¡†æ¶å®ç°ï¼Œæ‰€æœ‰æ ¸å¿ƒæ•°æ®å­˜å‚¨ä½¿ç”¨æœ¬åœ°ç¼“å­˜ `wx.setStorageSync` / `wx.getStorageSync`ï¼Œæ— éœ€åç«¯å¼€å‘ã€‚åç»­å¯æŒ‰éœ€æ‰©å±•ã€‚